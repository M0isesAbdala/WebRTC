import{createRequire as L7}from"node:module";var C7=Object.create;var{getPrototypeOf:U7,defineProperty:r5,getOwnPropertyNames:q7}=Object;var T7=Object.prototype.hasOwnProperty;var o=(J,K,X)=>{X=J!=null?C7(U7(J)):{};let Z=K||!J||!J.__esModule?r5(X,"default",{value:J,enumerable:!0}):X;for(let $ of q7(J))if(!T7.call(Z,$))r5(Z,$,{get:()=>J[$],enumerable:!0});return Z};var F=(J,K)=>()=>(K||J((K={exports:{}}).exports,K),K.exports);var N=L7(import.meta.url);var T=F((jK,s5)=>{var a5=["nodebuffer","arraybuffer","fragments"],o5=typeof Blob!=="undefined";if(o5)a5.push("blob");s5.exports={BINARY_TYPES:a5,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:o5,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var H4=F((YK,_4)=>{var K4=N("fs"),L=N("path"),X4=N("os"),Z4=typeof __webpack_require__==="function"?__non_webpack_require__:N,x7=process.config&&process.config.variables||{},W7=!!process.env.PREBUILDS_ONLY,t5=process.versions.modules,M5=S7()?"electron":y7()?"node-webkit":"node",O5=process.env.npm_config_arch||X4.arch(),P5=process.env.npm_config_platform||X4.platform(),$4=process.env.LIBC||(v7(P5)?"musl":"glibc"),B5=process.env.ARM_VERSION||(O5==="arm64"?"8":x7.arm_version)||"",G4=(process.versions.uv||"").split(".")[0];_4.exports=U;function U(J){return Z4(U.resolve(J))}U.resolve=U.path=function(J){J=L.resolve(J||".");try{var K=Z4(L.join(J,"package.json")).name.toUpperCase().replace(/-/g,"_");if(process.env[K+"_PREBUILD"])J=process.env[K+"_PREBUILD"]}catch(Q){}if(!W7){var X=e5(L.join(J,"build/Release"),J4);if(X)return X;var Z=e5(L.join(J,"build/Debug"),J4);if(Z)return Z}var $=j(J);if($)return $;var G=j(L.dirname(process.execPath));if(G)return G;var z=["platform="+P5,"arch="+O5,"runtime="+M5,"abi="+t5,"uv="+G4,B5?"armv="+B5:"","libc="+$4,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__==="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+z+`
    loaded from: `+J+`
`);function j(Q){var I=C5(L.join(Q,"prebuilds")).map(Q4),_=I.filter(z4(P5,O5)).sort(j4)[0];if(!_)return;var Y=L.join(Q,"prebuilds",_.name),A=C5(Y).map(Y4),M=A.filter(V4(M5,t5)),R=M.sort(I4(M5))[0];if(R)return L.join(Y,R.file)}};function C5(J){try{return K4.readdirSync(J)}catch(K){return[]}}function e5(J,K){var X=C5(J).filter(K);return X[0]&&L.join(J,X[0])}function J4(J){return/\.node$/.test(J)}function Q4(J){var K=J.split("-");if(K.length!==2)return;var X=K[0],Z=K[1].split("+");if(!X)return;if(!Z.length)return;if(!Z.every(Boolean))return;return{name:J,platform:X,architectures:Z}}function z4(J,K){return function(X){if(X==null)return!1;if(X.platform!==J)return!1;return X.architectures.includes(K)}}function j4(J,K){return J.architectures.length-K.architectures.length}function Y4(J){var K=J.split("."),X=K.pop(),Z={file:J,specificity:0};if(X!=="node")return;for(var $=0;$<K.length;$++){var G=K[$];if(G==="node"||G==="electron"||G==="node-webkit")Z.runtime=G;else if(G==="napi")Z.napi=!0;else if(G.slice(0,3)==="abi")Z.abi=G.slice(3);else if(G.slice(0,2)==="uv")Z.uv=G.slice(2);else if(G.slice(0,4)==="armv")Z.armv=G.slice(4);else if(G==="glibc"||G==="musl")Z.libc=G;else continue;Z.specificity++}return Z}function V4(J,K){return function(X){if(X==null)return!1;if(X.runtime&&X.runtime!==J&&!E7(X))return!1;if(X.abi&&X.abi!==K&&!X.napi)return!1;if(X.uv&&X.uv!==G4)return!1;if(X.armv&&X.armv!==B5)return!1;if(X.libc&&X.libc!==$4)return!1;return!0}}function E7(J){return J.runtime==="node"&&J.napi}function I4(J){return function(K,X){if(K.runtime!==X.runtime)return K.runtime===J?-1:1;else if(K.abi!==X.abi)return K.abi?-1:1;else if(K.specificity!==X.specificity)return K.specificity>X.specificity?-1:1;else return 0}}function y7(){return!!(process.versions&&process.versions.nw)}function S7(){if(process.versions&&process.versions.electron)return!0;if(process.env.ELECTRON_RUN_AS_NODE)return!0;return typeof window!=="undefined"&&window.process&&window.process.type==="renderer"}function v7(J){return J==="linux"&&K4.existsSync("/etc/alpine-release")}U.parseTags=Y4;U.matchTags=V4;U.compareTags=I4;U.parseTuple=Q4;U.matchTuple=z4;U.compareTuples=j4});var T5=F((IK,q5)=>{var U5=typeof __webpack_require__==="function"?__non_webpack_require__:N;if(typeof U5.addon==="function")q5.exports=U5.addon.bind(U5);else q5.exports=H4()});var R4=F((HK,N4)=>{var w7=(J,K,X,Z,$)=>{for(var G=0;G<$;G++)X[Z+G]=J[G]^K[G&3]},h7=(J,K)=>{let X=J.length;for(var Z=0;Z<X;Z++)J[Z]^=K[Z&3]};N4.exports={mask:w7,unmask:h7}});var A4=F((NK,L5)=>{var __dirname="C:\\Users\\desen\\OneDrive\\Área de Trabalho\\WebRTC\\node_modules\\bufferutil";try{L5.exports=T5()(__dirname)}catch(J){L5.exports=R4()}});var s=F((RK,G5)=>{var{EMPTY_BUFFER:g7}=T(),x5=Buffer[Symbol.species];function m7(J,K){if(J.length===0)return g7;if(J.length===1)return J[0];let X=Buffer.allocUnsafe(K),Z=0;for(let $=0;$<J.length;$++){let G=J[$];X.set(G,Z),Z+=G.length}if(Z<K)return new x5(X.buffer,X.byteOffset,Z);return X}function F4(J,K,X,Z,$){for(let G=0;G<$;G++)X[Z+G]=J[G]^K[G&3]}function D4(J,K){for(let X=0;X<J.length;X++)J[X]^=K[X&3]}function f7(J){if(J.length===J.buffer.byteLength)return J.buffer;return J.buffer.slice(J.byteOffset,J.byteOffset+J.length)}function W5(J){if(W5.readOnly=!0,Buffer.isBuffer(J))return J;let K;if(J instanceof ArrayBuffer)K=new x5(J);else if(ArrayBuffer.isView(J))K=new x5(J.buffer,J.byteOffset,J.byteLength);else K=Buffer.from(J),W5.readOnly=!1;return K}G5.exports={concat:m7,mask:F4,toArrayBuffer:f7,toBuffer:W5,unmask:D4};if(!process.env.WS_NO_BUFFER_UTIL)try{let J=A4();G5.exports.mask=function(K,X,Z,$,G){if(G<48)F4(K,X,Z,$,G);else J.mask(K,X,Z,$,G)},G5.exports.unmask=function(K,X){if(K.length<32)D4(K,X);else J.unmask(K,X)}}catch(J){}});var B4=F((AK,P4)=>{var M4=Symbol("kDone"),E5=Symbol("kRun");class O4{constructor(J){this[M4]=()=>{this.pending--,this[E5]()},this.concurrency=J||1/0,this.jobs=[],this.pending=0}add(J){this.jobs.push(J),this[E5]()}[E5](){if(this.pending===this.concurrency)return;if(this.jobs.length){let J=this.jobs.shift();this.pending++,J(this[M4])}}}P4.exports=O4});var e=F((FK,L4)=>{var t=N("zlib"),C4=s(),u7=B4(),{kStatusCode:U4}=T(),l7=Buffer[Symbol.species],p7=Buffer.from([0,0,255,255]),z5=Symbol("permessage-deflate"),x=Symbol("total-length"),p=Symbol("callback"),E=Symbol("buffers"),k=Symbol("error"),Q5;class q4{constructor(J,K,X){if(this._maxPayload=X|0,this._options=J||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!K,this._deflate=null,this._inflate=null,this.params=null,!Q5){let Z=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Q5=new u7(Z)}}static get extensionName(){return"permessage-deflate"}offer(){let J={};if(this._options.serverNoContextTakeover)J.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)J.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)J.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)J.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)J.client_max_window_bits=!0;return J}accept(J){return J=this.normalizeParams(J),this.params=this._isServer?this.acceptAsServer(J):this.acceptAsClient(J),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let J=this._deflate[p];if(this._deflate.close(),this._deflate=null,J)J(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(J){let K=this._options,X=J.find((Z)=>{if(K.serverNoContextTakeover===!1&&Z.server_no_context_takeover||Z.server_max_window_bits&&(K.serverMaxWindowBits===!1||typeof K.serverMaxWindowBits==="number"&&K.serverMaxWindowBits>Z.server_max_window_bits)||typeof K.clientMaxWindowBits==="number"&&!Z.client_max_window_bits)return!1;return!0});if(!X)throw new Error("None of the extension offers can be accepted");if(K.serverNoContextTakeover)X.server_no_context_takeover=!0;if(K.clientNoContextTakeover)X.client_no_context_takeover=!0;if(typeof K.serverMaxWindowBits==="number")X.server_max_window_bits=K.serverMaxWindowBits;if(typeof K.clientMaxWindowBits==="number")X.client_max_window_bits=K.clientMaxWindowBits;else if(X.client_max_window_bits===!0||K.clientMaxWindowBits===!1)delete X.client_max_window_bits;return X}acceptAsClient(J){let K=J[0];if(this._options.clientNoContextTakeover===!1&&K.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!K.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")K.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&K.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return K}normalizeParams(J){return J.forEach((K)=>{Object.keys(K).forEach((X)=>{let Z=K[X];if(Z.length>1)throw new Error(`Parameter "${X}" must have only a single value`);if(Z=Z[0],X==="client_max_window_bits"){if(Z!==!0){let $=+Z;if(!Number.isInteger($)||$<8||$>15)throw new TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=$}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${X}": ${Z}`)}else if(X==="server_max_window_bits"){let $=+Z;if(!Number.isInteger($)||$<8||$>15)throw new TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=$}else if(X==="client_no_context_takeover"||X==="server_no_context_takeover"){if(Z!==!0)throw new TypeError(`Invalid value for parameter "${X}": ${Z}`)}else throw new Error(`Unknown parameter "${X}"`);K[X]=Z})}),J}decompress(J,K,X){Q5.add((Z)=>{this._decompress(J,K,($,G)=>{Z(),X($,G)})})}compress(J,K,X){Q5.add((Z)=>{this._compress(J,K,($,G)=>{Z(),X($,G)})})}_decompress(J,K,X){let Z=this._isServer?"client":"server";if(!this._inflate){let $=`${Z}_max_window_bits`,G=typeof this.params[$]!=="number"?t.Z_DEFAULT_WINDOWBITS:this.params[$];this._inflate=t.createInflateRaw({...this._options.zlibInflateOptions,windowBits:G}),this._inflate[z5]=this,this._inflate[x]=0,this._inflate[E]=[],this._inflate.on("error",b7),this._inflate.on("data",T4)}if(this._inflate[p]=X,this._inflate.write(J),K)this._inflate.write(p7);this._inflate.flush(()=>{let $=this._inflate[k];if($){this._inflate.close(),this._inflate=null,X($);return}let G=C4.concat(this._inflate[E],this._inflate[x]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[x]=0,this._inflate[E]=[],K&&this.params[`${Z}_no_context_takeover`])this._inflate.reset();X(null,G)})}_compress(J,K,X){let Z=this._isServer?"server":"client";if(!this._deflate){let $=`${Z}_max_window_bits`,G=typeof this.params[$]!=="number"?t.Z_DEFAULT_WINDOWBITS:this.params[$];this._deflate=t.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:G}),this._deflate[x]=0,this._deflate[E]=[],this._deflate.on("data",k7)}this._deflate[p]=X,this._deflate.write(J),this._deflate.flush(t.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let $=C4.concat(this._deflate[E],this._deflate[x]);if(K)$=new l7($.buffer,$.byteOffset,$.length-4);if(this._deflate[p]=null,this._deflate[x]=0,this._deflate[E]=[],K&&this.params[`${Z}_no_context_takeover`])this._deflate.reset();X(null,$)})}}L4.exports=q4;function k7(J){this[E].push(J),this[x]+=J.length}function T4(J){if(this[x]+=J.length,this[z5]._maxPayload<1||this[x]<=this[z5]._maxPayload){this[E].push(J);return}this[k]=new RangeError("Max payload size exceeded"),this[k].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[k][U4]=1009,this.removeListener("data",T4),this.reset()}function b7(J){if(this[z5]._inflate=null,this[k]){this[p](this[k]);return}J[U4]=1007,this[p](J)}});var W4=F((DK,x4)=>{function d7(J){let K=J.length,X=0;while(X<K)if((J[X]&128)===0)X++;else if((J[X]&224)===192){if(X+1===K||(J[X+1]&192)!==128||(J[X]&254)===192)return!1;X+=2}else if((J[X]&240)===224){if(X+2>=K||(J[X+1]&192)!==128||(J[X+2]&192)!==128||J[X]===224&&(J[X+1]&224)===128||J[X]===237&&(J[X+1]&224)===160)return!1;X+=3}else if((J[X]&248)===240){if(X+3>=K||(J[X+1]&192)!==128||(J[X+2]&192)!==128||(J[X+3]&192)!==128||J[X]===240&&(J[X+1]&240)===128||J[X]===244&&J[X+1]>143||J[X]>244)return!1;X+=4}else return!1;return!0}x4.exports=d7});var E4=F((MK,y5)=>{var __dirname="C:\\Users\\desen\\OneDrive\\Área de Trabalho\\WebRTC\\node_modules\\utf-8-validate";try{y5.exports=T5()(__dirname)}catch(J){y5.exports=W4()}});var b=F((OK,j5)=>{var{isUtf8:y4}=N("buffer"),{hasBlob:i7}=T(),c7=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function n7(J){return J>=1000&&J<=1014&&J!==1004&&J!==1005&&J!==1006||J>=3000&&J<=4999}function S5(J){let K=J.length,X=0;while(X<K)if((J[X]&128)===0)X++;else if((J[X]&224)===192){if(X+1===K||(J[X+1]&192)!==128||(J[X]&254)===192)return!1;X+=2}else if((J[X]&240)===224){if(X+2>=K||(J[X+1]&192)!==128||(J[X+2]&192)!==128||J[X]===224&&(J[X+1]&224)===128||J[X]===237&&(J[X+1]&224)===160)return!1;X+=3}else if((J[X]&248)===240){if(X+3>=K||(J[X+1]&192)!==128||(J[X+2]&192)!==128||(J[X+3]&192)!==128||J[X]===240&&(J[X+1]&240)===128||J[X]===244&&J[X+1]>143||J[X]>244)return!1;X+=4}else return!1;return!0}function r7(J){return i7&&typeof J==="object"&&typeof J.arrayBuffer==="function"&&typeof J.type==="string"&&typeof J.stream==="function"&&(J[Symbol.toStringTag]==="Blob"||J[Symbol.toStringTag]==="File")}j5.exports={isBlob:r7,isValidStatusCode:n7,isValidUTF8:S5,tokenChars:c7};if(y4)j5.exports.isValidUTF8=function(J){return J.length<24?S5(J):y4(J)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let J=E4();j5.exports.isValidUTF8=function(K){return K.length<32?S5(K):J(K)}}catch(J){}});var w5=F((PK,g4)=>{var{Writable:a7}=N("stream"),S4=e(),{BINARY_TYPES:o7,EMPTY_BUFFER:v4,kStatusCode:s7,kWebSocket:t7}=T(),{concat:v5,toArrayBuffer:e7,unmask:JJ}=s(),{isValidStatusCode:KJ,isValidUTF8:w4}=b(),Y5=Buffer[Symbol.species];class h4 extends a7{constructor(J={}){super();this._allowSynchronousEvents=J.allowSynchronousEvents!==void 0?J.allowSynchronousEvents:!0,this._binaryType=J.binaryType||o7[0],this._extensions=J.extensions||{},this._isServer=!!J.isServer,this._maxPayload=J.maxPayload|0,this._skipUTF8Validation=!!J.skipUTF8Validation,this[t7]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(J,K,X){if(this._opcode===8&&this._state==0)return X();this._bufferedBytes+=J.length,this._buffers.push(J),this.startLoop(X)}consume(J){if(this._bufferedBytes-=J,J===this._buffers[0].length)return this._buffers.shift();if(J<this._buffers[0].length){let X=this._buffers[0];return this._buffers[0]=new Y5(X.buffer,X.byteOffset+J,X.length-J),new Y5(X.buffer,X.byteOffset,J)}let K=Buffer.allocUnsafe(J);do{let X=this._buffers[0],Z=K.length-J;if(J>=X.length)K.set(this._buffers.shift(),Z);else K.set(new Uint8Array(X.buffer,X.byteOffset,J),Z),this._buffers[0]=new Y5(X.buffer,X.byteOffset+J,X.length-J);J-=X.length}while(J>0);return K}startLoop(J){this._loop=!0;do switch(this._state){case 0:this.getInfo(J);break;case 1:this.getPayloadLength16(J);break;case 2:this.getPayloadLength64(J);break;case 3:this.getMask();break;case 4:this.getData(J);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)J()}getInfo(J){if(this._bufferedBytes<2){this._loop=!1;return}let K=this.consume(2);if((K[0]&48)!==0){let Z=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");J(Z);return}let X=(K[0]&64)===64;if(X&&!this._extensions[S4.extensionName]){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");J(Z);return}if(this._fin=(K[0]&128)===128,this._opcode=K[0]&15,this._payloadLength=K[1]&127,this._opcode===0){if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");J(Z);return}if(!this._fragmented){let Z=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");J(Z);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");J(Z);return}this._compressed=X}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let Z=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");J(Z);return}if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");J(Z);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let Z=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");J(Z);return}}else{let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");J(Z);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=(K[1]&128)===128,this._isServer){if(!this._masked){let Z=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");J(Z);return}}else if(this._masked){let Z=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");J(Z);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(J)}getPayloadLength16(J){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(J)}getPayloadLength64(J){if(this._bufferedBytes<8){this._loop=!1;return}let K=this.consume(8),X=K.readUInt32BE(0);if(X>Math.pow(2,21)-1){let Z=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");J(Z);return}this._payloadLength=X*Math.pow(2,32)+K.readUInt32BE(4),this.haveLength(J)}haveLength(J){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let K=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");J(K);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(J){let K=v4;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if(K=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)JJ(K,this._mask)}if(this._opcode>7){this.controlMessage(K,J);return}if(this._compressed){this._state=5,this.decompress(K,J);return}if(K.length)this._messageLength=this._totalPayloadLength,this._fragments.push(K);this.dataMessage(J)}decompress(J,K){this._extensions[S4.extensionName].decompress(J,this._fin,(Z,$)=>{if(Z)return K(Z);if($.length){if(this._messageLength+=$.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let G=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");K(G);return}this._fragments.push($)}if(this.dataMessage(K),this._state===0)this.startLoop(K)})}dataMessage(J){if(!this._fin){this._state=0;return}let K=this._messageLength,X=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let Z;if(this._binaryType==="nodebuffer")Z=v5(X,K);else if(this._binaryType==="arraybuffer")Z=e7(v5(X,K));else if(this._binaryType==="blob")Z=new Blob(X);else Z=X;if(this._allowSynchronousEvents)this.emit("message",Z,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!0),this._state=0,this.startLoop(J)})}else{let Z=v5(X,K);if(!this._skipUTF8Validation&&!w4(Z)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");J($);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",Z,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!1),this._state=0,this.startLoop(J)})}}controlMessage(J,K){if(this._opcode===8){if(J.length===0)this._loop=!1,this.emit("conclude",1005,v4),this.end();else{let X=J.readUInt16BE(0);if(!KJ(X)){let $=this.createError(RangeError,`invalid status code ${X}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");K($);return}let Z=new Y5(J.buffer,J.byteOffset+2,J.length-2);if(!this._skipUTF8Validation&&!w4(Z)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");K($);return}this._loop=!1,this.emit("conclude",X,Z),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",J),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",J),this._state=0,this.startLoop(K)})}createError(J,K,X,Z,$){this._loop=!1,this._errored=!0;let G=new J(X?`Invalid WebSocket frame: ${K}`:K);return Error.captureStackTrace(G,this.createError),G.code=$,G[s7]=Z,G}}g4.exports=h4});var g5=F((CK,u4)=>{var{Duplex:BK}=N("stream"),{randomFillSync:XJ}=N("crypto"),m4=e(),{EMPTY_BUFFER:ZJ,kWebSocket:$J,NOOP:GJ}=T(),{isBlob:d,isValidStatusCode:QJ}=b(),{mask:f4,toBuffer:w}=s(),B=Symbol("kByteLength"),zJ=Buffer.alloc(4),h,i=8192,C=0,jJ=1,YJ=2;class y{constructor(J,K,X){if(this._extensions=K||{},X)this._generateMask=X,this._maskBuffer=Buffer.alloc(4);this._socket=J,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=C,this.onerror=GJ,this[$J]=void 0}static frame(J,K){let X,Z=!1,$=2,G=!1;if(K.mask){if(X=K.maskBuffer||zJ,K.generateMask)K.generateMask(X);else{if(i===8192){if(h===void 0)h=Buffer.alloc(8192);XJ(h,0,8192),i=0}X[0]=h[i++],X[1]=h[i++],X[2]=h[i++],X[3]=h[i++]}G=(X[0]|X[1]|X[2]|X[3])===0,$=6}let z;if(typeof J==="string")if((!K.mask||G)&&K[B]!==void 0)z=K[B];else J=Buffer.from(J),z=J.length;else z=J.length,Z=K.mask&&K.readOnly&&!G;let j=z;if(z>=65536)$+=8,j=127;else if(z>125)$+=2,j=126;let Q=Buffer.allocUnsafe(Z?z+$:$);if(Q[0]=K.fin?K.opcode|128:K.opcode,K.rsv1)Q[0]|=64;if(Q[1]=j,j===126)Q.writeUInt16BE(z,2);else if(j===127)Q[2]=Q[3]=0,Q.writeUIntBE(z,4,6);if(!K.mask)return[Q,J];if(Q[1]|=128,Q[$-4]=X[0],Q[$-3]=X[1],Q[$-2]=X[2],Q[$-1]=X[3],G)return[Q,J];if(Z)return f4(J,X,Q,$,z),[Q];return f4(J,X,J,0,z),[Q,J]}close(J,K,X,Z){let $;if(J===void 0)$=ZJ;else if(typeof J!=="number"||!QJ(J))throw new TypeError("First argument must be a valid error code number");else if(K===void 0||!K.length)$=Buffer.allocUnsafe(2),$.writeUInt16BE(J,0);else{let z=Buffer.byteLength(K);if(z>123)throw new RangeError("The message must not be greater than 123 bytes");if($=Buffer.allocUnsafe(2+z),$.writeUInt16BE(J,0),typeof K==="string")$.write(K,2);else $.set(K,2)}let G={[B]:$.length,fin:!0,generateMask:this._generateMask,mask:X,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==C)this.enqueue([this.dispatch,$,!1,G,Z]);else this.sendFrame(y.frame($,G),Z)}ping(J,K,X){let Z,$;if(typeof J==="string")Z=Buffer.byteLength(J),$=!1;else if(d(J))Z=J.size,$=!1;else J=w(J),Z=J.length,$=w.readOnly;if(Z>125)throw new RangeError("The data size must not be greater than 125 bytes");let G={[B]:Z,fin:!0,generateMask:this._generateMask,mask:K,maskBuffer:this._maskBuffer,opcode:9,readOnly:$,rsv1:!1};if(d(J))if(this._state!==C)this.enqueue([this.getBlobData,J,!1,G,X]);else this.getBlobData(J,!1,G,X);else if(this._state!==C)this.enqueue([this.dispatch,J,!1,G,X]);else this.sendFrame(y.frame(J,G),X)}pong(J,K,X){let Z,$;if(typeof J==="string")Z=Buffer.byteLength(J),$=!1;else if(d(J))Z=J.size,$=!1;else J=w(J),Z=J.length,$=w.readOnly;if(Z>125)throw new RangeError("The data size must not be greater than 125 bytes");let G={[B]:Z,fin:!0,generateMask:this._generateMask,mask:K,maskBuffer:this._maskBuffer,opcode:10,readOnly:$,rsv1:!1};if(d(J))if(this._state!==C)this.enqueue([this.getBlobData,J,!1,G,X]);else this.getBlobData(J,!1,G,X);else if(this._state!==C)this.enqueue([this.dispatch,J,!1,G,X]);else this.sendFrame(y.frame(J,G),X)}send(J,K,X){let Z=this._extensions[m4.extensionName],$=K.binary?2:1,G=K.compress,z,j;if(typeof J==="string")z=Buffer.byteLength(J),j=!1;else if(d(J))z=J.size,j=!1;else J=w(J),z=J.length,j=w.readOnly;if(this._firstFragment){if(this._firstFragment=!1,G&&Z&&Z.params[Z._isServer?"server_no_context_takeover":"client_no_context_takeover"])G=z>=Z._threshold;this._compress=G}else G=!1,$=0;if(K.fin)this._firstFragment=!0;let Q={[B]:z,fin:K.fin,generateMask:this._generateMask,mask:K.mask,maskBuffer:this._maskBuffer,opcode:$,readOnly:j,rsv1:G};if(d(J))if(this._state!==C)this.enqueue([this.getBlobData,J,this._compress,Q,X]);else this.getBlobData(J,this._compress,Q,X);else if(this._state!==C)this.enqueue([this.dispatch,J,this._compress,Q,X]);else this.dispatch(J,this._compress,Q,X)}getBlobData(J,K,X,Z){this._bufferedBytes+=X[B],this._state=YJ,J.arrayBuffer().then(($)=>{if(this._socket.destroyed){let z=new Error("The socket was closed while the blob was being read");process.nextTick(h5,this,z,Z);return}this._bufferedBytes-=X[B];let G=w($);if(!K)this._state=C,this.sendFrame(y.frame(G,X),Z),this.dequeue();else this.dispatch(G,K,X,Z)}).catch(($)=>{process.nextTick(VJ,this,$,Z)})}dispatch(J,K,X,Z){if(!K){this.sendFrame(y.frame(J,X),Z);return}let $=this._extensions[m4.extensionName];this._bufferedBytes+=X[B],this._state=jJ,$.compress(J,X.fin,(G,z)=>{if(this._socket.destroyed){let j=new Error("The socket was closed while data was being compressed");h5(this,j,Z);return}this._bufferedBytes-=X[B],this._state=C,X.readOnly=!1,this.sendFrame(y.frame(z,X),Z),this.dequeue()})}dequeue(){while(this._state===C&&this._queue.length){let J=this._queue.shift();this._bufferedBytes-=J[3][B],Reflect.apply(J[0],this,J.slice(1))}}enqueue(J){this._bufferedBytes+=J[3][B],this._queue.push(J)}sendFrame(J,K){if(J.length===2)this._socket.cork(),this._socket.write(J[0]),this._socket.write(J[1],K),this._socket.uncork();else this._socket.write(J[0],K)}}u4.exports=y;function h5(J,K,X){if(typeof X==="function")X(K);for(let Z=0;Z<J._queue.length;Z++){let $=J._queue[Z],G=$[$.length-1];if(typeof G==="function")G(K)}}function VJ(J,K,X){h5(J,K,X),J.onerror(K)}});var r4=F((UK,n4)=>{var{kForOnEventAttribute:J5,kListener:m5}=T(),l4=Symbol("kCode"),p4=Symbol("kData"),k4=Symbol("kError"),b4=Symbol("kMessage"),d4=Symbol("kReason"),c=Symbol("kTarget"),i4=Symbol("kType"),c4=Symbol("kWasClean");class S{constructor(J){this[c]=null,this[i4]=J}get target(){return this[c]}get type(){return this[i4]}}Object.defineProperty(S.prototype,"target",{enumerable:!0});Object.defineProperty(S.prototype,"type",{enumerable:!0});class n extends S{constructor(J,K={}){super(J);this[l4]=K.code===void 0?0:K.code,this[d4]=K.reason===void 0?"":K.reason,this[c4]=K.wasClean===void 0?!1:K.wasClean}get code(){return this[l4]}get reason(){return this[d4]}get wasClean(){return this[c4]}}Object.defineProperty(n.prototype,"code",{enumerable:!0});Object.defineProperty(n.prototype,"reason",{enumerable:!0});Object.defineProperty(n.prototype,"wasClean",{enumerable:!0});class K5 extends S{constructor(J,K={}){super(J);this[k4]=K.error===void 0?null:K.error,this[b4]=K.message===void 0?"":K.message}get error(){return this[k4]}get message(){return this[b4]}}Object.defineProperty(K5.prototype,"error",{enumerable:!0});Object.defineProperty(K5.prototype,"message",{enumerable:!0});class I5 extends S{constructor(J,K={}){super(J);this[p4]=K.data===void 0?null:K.data}get data(){return this[p4]}}Object.defineProperty(I5.prototype,"data",{enumerable:!0});var IJ={addEventListener(J,K,X={}){for(let $ of this.listeners(J))if(!X[J5]&&$[m5]===K&&!$[J5])return;let Z;if(J==="message")Z=function $(G,z){let j=new I5("message",{data:z?G:G.toString()});j[c]=this,V5(K,this,j)};else if(J==="close")Z=function $(G,z){let j=new n("close",{code:G,reason:z.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});j[c]=this,V5(K,this,j)};else if(J==="error")Z=function $(G){let z=new K5("error",{error:G,message:G.message});z[c]=this,V5(K,this,z)};else if(J==="open")Z=function $(){let G=new S("open");G[c]=this,V5(K,this,G)};else return;if(Z[J5]=!!X[J5],Z[m5]=K,X.once)this.once(J,Z);else this.on(J,Z)},removeEventListener(J,K){for(let X of this.listeners(J))if(X[m5]===K&&!X[J5]){this.removeListener(J,X);break}}};n4.exports={CloseEvent:n,ErrorEvent:K5,Event:S,EventTarget:IJ,MessageEvent:I5};function V5(J,K,X){if(typeof J==="object"&&J.handleEvent)J.handleEvent.call(J,X);else J.call(K,X)}});var f5=F((qK,a4)=>{var{tokenChars:X5}=b();function q(J,K,X){if(J[K]===void 0)J[K]=[X];else J[K].push(X)}function _J(J){let K=Object.create(null),X=Object.create(null),Z=!1,$=!1,G=!1,z,j,Q=-1,I=-1,_=-1,Y=0;for(;Y<J.length;Y++)if(I=J.charCodeAt(Y),z===void 0)if(_===-1&&X5[I]===1){if(Q===-1)Q=Y}else if(Y!==0&&(I===32||I===9)){if(_===-1&&Q!==-1)_=Y}else if(I===59||I===44){if(Q===-1)throw new SyntaxError(`Unexpected character at index ${Y}`);if(_===-1)_=Y;let M=J.slice(Q,_);if(I===44)q(K,M,X),X=Object.create(null);else z=M;Q=_=-1}else throw new SyntaxError(`Unexpected character at index ${Y}`);else if(j===void 0)if(_===-1&&X5[I]===1){if(Q===-1)Q=Y}else if(I===32||I===9){if(_===-1&&Q!==-1)_=Y}else if(I===59||I===44){if(Q===-1)throw new SyntaxError(`Unexpected character at index ${Y}`);if(_===-1)_=Y;if(q(X,J.slice(Q,_),!0),I===44)q(K,z,X),X=Object.create(null),z=void 0;Q=_=-1}else if(I===61&&Q!==-1&&_===-1)j=J.slice(Q,Y),Q=_=-1;else throw new SyntaxError(`Unexpected character at index ${Y}`);else if($){if(X5[I]!==1)throw new SyntaxError(`Unexpected character at index ${Y}`);if(Q===-1)Q=Y;else if(!Z)Z=!0;$=!1}else if(G)if(X5[I]===1){if(Q===-1)Q=Y}else if(I===34&&Q!==-1)G=!1,_=Y;else if(I===92)$=!0;else throw new SyntaxError(`Unexpected character at index ${Y}`);else if(I===34&&J.charCodeAt(Y-1)===61)G=!0;else if(_===-1&&X5[I]===1){if(Q===-1)Q=Y}else if(Q!==-1&&(I===32||I===9)){if(_===-1)_=Y}else if(I===59||I===44){if(Q===-1)throw new SyntaxError(`Unexpected character at index ${Y}`);if(_===-1)_=Y;let M=J.slice(Q,_);if(Z)M=M.replace(/\\/g,""),Z=!1;if(q(X,j,M),I===44)q(K,z,X),X=Object.create(null),z=void 0;j=void 0,Q=_=-1}else throw new SyntaxError(`Unexpected character at index ${Y}`);if(Q===-1||G||I===32||I===9)throw new SyntaxError("Unexpected end of input");if(_===-1)_=Y;let A=J.slice(Q,_);if(z===void 0)q(K,A,X);else{if(j===void 0)q(X,A,!0);else if(Z)q(X,j,A.replace(/\\/g,""));else q(X,j,A);q(K,z,X)}return K}function HJ(J){return Object.keys(J).map((K)=>{let X=J[K];if(!Array.isArray(X))X=[X];return X.map((Z)=>{return[K].concat(Object.keys(Z).map(($)=>{let G=Z[$];if(!Array.isArray(G))G=[G];return G.map((z)=>z===!0?$:`${$}=${z}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}a4.exports={format:HJ,parse:_J}});var R5=F((xK,z7)=>{var NJ=N("events"),RJ=N("https"),AJ=N("http"),t4=N("net"),FJ=N("tls"),{randomBytes:DJ,createHash:MJ}=N("crypto"),{Duplex:TK,Readable:LK}=N("stream"),{URL:u5}=N("url"),v=e(),OJ=w5(),PJ=g5(),{isBlob:BJ}=b(),{BINARY_TYPES:o4,EMPTY_BUFFER:_5,GUID:CJ,kForOnEventAttribute:l5,kListener:UJ,kStatusCode:qJ,kWebSocket:D,NOOP:e4}=T(),{EventTarget:{addEventListener:TJ,removeEventListener:LJ}}=r4(),{format:xJ,parse:WJ}=f5(),{toBuffer:EJ}=s(),J7=Symbol("kAborted"),p5=[8,13],W=["CONNECTING","OPEN","CLOSING","CLOSED"],yJ=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class V extends NJ{constructor(J,K,X){super();if(this._binaryType=o4[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_5,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=V.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,J!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,K===void 0)K=[];else if(!Array.isArray(K))if(typeof K==="object"&&K!==null)X=K,K=[];else K=[K];K7(this,J,K,X)}else this._autoPong=X.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(J){if(!o4.includes(J))return;if(this._binaryType=J,this._receiver)this._receiver._binaryType=J}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(J,K,X){let Z=new OJ({allowSynchronousEvents:X.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:X.maxPayload,skipUTF8Validation:X.skipUTF8Validation}),$=new PJ(J,this._extensions,X.generateMask);if(this._receiver=Z,this._sender=$,this._socket=J,Z[D]=this,$[D]=this,J[D]=this,Z.on("conclude",wJ),Z.on("drain",hJ),Z.on("error",gJ),Z.on("message",mJ),Z.on("ping",fJ),Z.on("pong",uJ),$.onerror=lJ,J.setTimeout)J.setTimeout(0);if(J.setNoDelay)J.setNoDelay();if(K.length>0)J.unshift(K);J.on("close",$7),J.on("data",N5),J.on("end",G7),J.on("error",Q7),this._readyState=V.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=V.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[v.extensionName])this._extensions[v.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=V.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(J,K){if(this.readyState===V.CLOSED)return;if(this.readyState===V.CONNECTING){P(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===V.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=V.CLOSING,this._sender.close(J,K,!this._isServer,(X)=>{if(X)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),Z7(this)}pause(){if(this.readyState===V.CONNECTING||this.readyState===V.CLOSED)return;this._paused=!0,this._socket.pause()}ping(J,K,X){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof J==="function")X=J,J=K=void 0;else if(typeof K==="function")X=K,K=void 0;if(typeof J==="number")J=J.toString();if(this.readyState!==V.OPEN){k5(this,J,X);return}if(K===void 0)K=!this._isServer;this._sender.ping(J||_5,K,X)}pong(J,K,X){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof J==="function")X=J,J=K=void 0;else if(typeof K==="function")X=K,K=void 0;if(typeof J==="number")J=J.toString();if(this.readyState!==V.OPEN){k5(this,J,X);return}if(K===void 0)K=!this._isServer;this._sender.pong(J||_5,K,X)}resume(){if(this.readyState===V.CONNECTING||this.readyState===V.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(J,K,X){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof K==="function")X=K,K={};if(typeof J==="number")J=J.toString();if(this.readyState!==V.OPEN){k5(this,J,X);return}let Z={binary:typeof J!=="string",mask:!this._isServer,compress:!0,fin:!0,...K};if(!this._extensions[v.extensionName])Z.compress=!1;this._sender.send(J||_5,Z,X)}terminate(){if(this.readyState===V.CLOSED)return;if(this.readyState===V.CONNECTING){P(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=V.CLOSING,this._socket.destroy()}}Object.defineProperty(V,"CONNECTING",{enumerable:!0,value:W.indexOf("CONNECTING")});Object.defineProperty(V.prototype,"CONNECTING",{enumerable:!0,value:W.indexOf("CONNECTING")});Object.defineProperty(V,"OPEN",{enumerable:!0,value:W.indexOf("OPEN")});Object.defineProperty(V.prototype,"OPEN",{enumerable:!0,value:W.indexOf("OPEN")});Object.defineProperty(V,"CLOSING",{enumerable:!0,value:W.indexOf("CLOSING")});Object.defineProperty(V.prototype,"CLOSING",{enumerable:!0,value:W.indexOf("CLOSING")});Object.defineProperty(V,"CLOSED",{enumerable:!0,value:W.indexOf("CLOSED")});Object.defineProperty(V.prototype,"CLOSED",{enumerable:!0,value:W.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((J)=>{Object.defineProperty(V.prototype,J,{enumerable:!0})});["open","error","close","message"].forEach((J)=>{Object.defineProperty(V.prototype,`on${J}`,{enumerable:!0,get(){for(let K of this.listeners(J))if(K[l5])return K[UJ];return null},set(K){for(let X of this.listeners(J))if(X[l5]){this.removeListener(J,X);break}if(typeof K!=="function")return;this.addEventListener(J,K,{[l5]:!0})}})});V.prototype.addEventListener=TJ;V.prototype.removeEventListener=LJ;z7.exports=V;function K7(J,K,X,Z){let $={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:p5[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...Z,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(J._autoPong=$.autoPong,!p5.includes($.protocolVersion))throw new RangeError(`Unsupported protocol version: ${$.protocolVersion} (supported versions: ${p5.join(", ")})`);let G;if(K instanceof u5)G=K;else try{G=new u5(K)}catch(H){throw new SyntaxError(`Invalid URL: ${K}`)}if(G.protocol==="http:")G.protocol="ws:";else if(G.protocol==="https:")G.protocol="wss:";J._url=G.href;let z=G.protocol==="wss:",j=G.protocol==="ws+unix:",Q;if(G.protocol!=="ws:"&&!z&&!j)Q=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(j&&!G.pathname)Q="The URL's pathname is empty";else if(G.hash)Q="The URL contains a fragment identifier";if(Q){let H=new SyntaxError(Q);if(J._redirects===0)throw H;else{H5(J,H);return}}let I=z?443:80,_=DJ(16).toString("base64"),Y=z?RJ.request:AJ.request,A=new Set,M;if($.createConnection=$.createConnection||(z?vJ:SJ),$.defaultPort=$.defaultPort||I,$.port=G.port||I,$.host=G.hostname.startsWith("[")?G.hostname.slice(1,-1):G.hostname,$.headers={...$.headers,"Sec-WebSocket-Version":$.protocolVersion,"Sec-WebSocket-Key":_,Connection:"Upgrade",Upgrade:"websocket"},$.path=G.pathname+G.search,$.timeout=$.handshakeTimeout,$.perMessageDeflate)M=new v($.perMessageDeflate!==!0?$.perMessageDeflate:{},!1,$.maxPayload),$.headers["Sec-WebSocket-Extensions"]=xJ({[v.extensionName]:M.offer()});if(X.length){for(let H of X){if(typeof H!=="string"||!yJ.test(H)||A.has(H))throw new SyntaxError("An invalid or duplicated subprotocol was specified");A.add(H)}$.headers["Sec-WebSocket-Protocol"]=X.join(",")}if($.origin)if($.protocolVersion<13)$.headers["Sec-WebSocket-Origin"]=$.origin;else $.headers.Origin=$.origin;if(G.username||G.password)$.auth=`${G.username}:${G.password}`;if(j){let H=$.path.split(":");$.socketPath=H[0],$.path=H[1]}let R;if($.followRedirects){if(J._redirects===0){J._originalIpc=j,J._originalSecure=z,J._originalHostOrSocketPath=j?$.socketPath:G.host;let H=Z&&Z.headers;if(Z={...Z,headers:{}},H)for(let[O,u]of Object.entries(H))Z.headers[O.toLowerCase()]=u}else if(J.listenerCount("redirect")===0){let H=j?J._originalIpc?$.socketPath===J._originalHostOrSocketPath:!1:J._originalIpc?!1:G.host===J._originalHostOrSocketPath;if(!H||J._originalSecure&&!z){if(delete $.headers.authorization,delete $.headers.cookie,!H)delete $.headers.host;$.auth=void 0}}if($.auth&&!Z.headers.authorization)Z.headers.authorization="Basic "+Buffer.from($.auth).toString("base64");if(R=J._req=Y($),J._redirects)J.emit("redirect",J.url,R)}else R=J._req=Y($);if($.timeout)R.on("timeout",()=>{P(J,R,"Opening handshake has timed out")});if(R.on("error",(H)=>{if(R===null||R[J7])return;R=J._req=null,H5(J,H)}),R.on("response",(H)=>{let O=H.headers.location,u=H.statusCode;if(O&&$.followRedirects&&u>=300&&u<400){if(++J._redirects>$.maxRedirects){P(J,R,"Maximum redirects exceeded");return}R.abort();let r;try{r=new u5(O,K)}catch(i5){let l=new SyntaxError(`Invalid URL: ${O}`);H5(J,l);return}K7(J,r,X,Z)}else if(!J.emit("unexpected-response",R,H))P(J,R,`Unexpected server response: ${H.statusCode}`)}),R.on("upgrade",(H,O,u)=>{if(J.emit("upgrade",H),J.readyState!==V.CONNECTING)return;R=J._req=null;let r=H.headers.upgrade;if(r===void 0||r.toLowerCase()!=="websocket"){P(J,O,"Invalid Upgrade header");return}let i5=MJ("sha1").update(_+CJ).digest("base64");if(H.headers["sec-websocket-accept"]!==i5){P(J,O,"Invalid Sec-WebSocket-Accept header");return}let l=H.headers["sec-websocket-protocol"],a;if(l!==void 0){if(!A.size)a="Server sent a subprotocol but none was requested";else if(!A.has(l))a="Server sent an invalid subprotocol"}else if(A.size)a="Server sent no subprotocol";if(a){P(J,O,a);return}if(l)J._protocol=l;let c5=H.headers["sec-websocket-extensions"];if(c5!==void 0){if(!M){P(J,O,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let F5;try{F5=WJ(c5)}catch(D5){P(J,O,"Invalid Sec-WebSocket-Extensions header");return}let n5=Object.keys(F5);if(n5.length!==1||n5[0]!==v.extensionName){P(J,O,"Server indicated an extension that was not requested");return}try{M.accept(F5[v.extensionName])}catch(D5){P(J,O,"Invalid Sec-WebSocket-Extensions header");return}J._extensions[v.extensionName]=M}J.setSocket(O,u,{allowSynchronousEvents:$.allowSynchronousEvents,generateMask:$.generateMask,maxPayload:$.maxPayload,skipUTF8Validation:$.skipUTF8Validation})}),$.finishRequest)$.finishRequest(R,J);else R.end()}function H5(J,K){J._readyState=V.CLOSING,J._errorEmitted=!0,J.emit("error",K),J.emitClose()}function SJ(J){return J.path=J.socketPath,t4.connect(J)}function vJ(J){if(J.path=void 0,!J.servername&&J.servername!=="")J.servername=t4.isIP(J.host)?"":J.host;return FJ.connect(J)}function P(J,K,X){J._readyState=V.CLOSING;let Z=new Error(X);if(Error.captureStackTrace(Z,P),K.setHeader){if(K[J7]=!0,K.abort(),K.socket&&!K.socket.destroyed)K.socket.destroy();process.nextTick(H5,J,Z)}else K.destroy(Z),K.once("error",J.emit.bind(J,"error")),K.once("close",J.emitClose.bind(J))}function k5(J,K,X){if(K){let Z=BJ(K)?K.size:EJ(K).length;if(J._socket)J._sender._bufferedBytes+=Z;else J._bufferedAmount+=Z}if(X){let Z=new Error(`WebSocket is not open: readyState ${J.readyState} (${W[J.readyState]})`);process.nextTick(X,Z)}}function wJ(J,K){let X=this[D];if(X._closeFrameReceived=!0,X._closeMessage=K,X._closeCode=J,X._socket[D]===void 0)return;if(X._socket.removeListener("data",N5),process.nextTick(X7,X._socket),J===1005)X.close();else X.close(J,K)}function hJ(){let J=this[D];if(!J.isPaused)J._socket.resume()}function gJ(J){let K=this[D];if(K._socket[D]!==void 0)K._socket.removeListener("data",N5),process.nextTick(X7,K._socket),K.close(J[qJ]);if(!K._errorEmitted)K._errorEmitted=!0,K.emit("error",J)}function s4(){this[D].emitClose()}function mJ(J,K){this[D].emit("message",J,K)}function fJ(J){let K=this[D];if(K._autoPong)K.pong(J,!this._isServer,e4);K.emit("ping",J)}function uJ(J){this[D].emit("pong",J)}function X7(J){J.resume()}function lJ(J){let K=this[D];if(K.readyState===V.CLOSED)return;if(K.readyState===V.OPEN)K._readyState=V.CLOSING,Z7(K);if(this._socket.end(),!K._errorEmitted)K._errorEmitted=!0,K.emit("error",J)}function Z7(J){J._closeTimer=setTimeout(J._socket.destroy.bind(J._socket),30000)}function $7(){let J=this[D];this.removeListener("close",$7),this.removeListener("data",N5),this.removeListener("end",G7),J._readyState=V.CLOSING;let K;if(!this._readableState.endEmitted&&!J._closeFrameReceived&&!J._receiver._writableState.errorEmitted&&(K=J._socket.read())!==null)J._receiver.write(K);if(J._receiver.end(),this[D]=void 0,clearTimeout(J._closeTimer),J._receiver._writableState.finished||J._receiver._writableState.errorEmitted)J.emitClose();else J._receiver.on("error",s4),J._receiver.on("finish",s4)}function N5(J){if(!this[D]._receiver.write(J))this.pause()}function G7(){let J=this[D];J._readyState=V.CLOSING,J._receiver.end(),this.end()}function Q7(){let J=this[D];if(this.removeListener("error",Q7),this.on("error",e4),J)J._readyState=V.CLOSING,this.destroy()}});var I7=F((EK,V7)=>{var WK=R5(),{Duplex:pJ}=N("stream");function j7(J){J.emit("close")}function kJ(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function Y7(J){if(this.removeListener("error",Y7),this.destroy(),this.listenerCount("error")===0)this.emit("error",J)}function bJ(J,K){let X=!0,Z=new pJ({...K,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return J.on("message",function $(G,z){let j=!z&&Z._readableState.objectMode?G.toString():G;if(!Z.push(j))J.pause()}),J.once("error",function $(G){if(Z.destroyed)return;X=!1,Z.destroy(G)}),J.once("close",function $(){if(Z.destroyed)return;Z.push(null)}),Z._destroy=function($,G){if(J.readyState===J.CLOSED){G($),process.nextTick(j7,Z);return}let z=!1;if(J.once("error",function j(Q){z=!0,G(Q)}),J.once("close",function j(){if(!z)G($);process.nextTick(j7,Z)}),X)J.terminate()},Z._final=function($){if(J.readyState===J.CONNECTING){J.once("open",function G(){Z._final($)});return}if(J._socket===null)return;if(J._socket._writableState.finished){if($(),Z._readableState.endEmitted)Z.destroy()}else J._socket.once("finish",function G(){$()}),J.close()},Z._read=function(){if(J.isPaused)J.resume()},Z._write=function($,G,z){if(J.readyState===J.CONNECTING){J.once("open",function j(){Z._write($,G,z)});return}J.send($,z)},Z.on("end",kJ),Z.on("error",Y7),Z}V7.exports=bJ});var H7=F((yK,_7)=>{var{tokenChars:dJ}=b();function iJ(J){let K=new Set,X=-1,Z=-1,$=0;for($;$<J.length;$++){let z=J.charCodeAt($);if(Z===-1&&dJ[z]===1){if(X===-1)X=$}else if($!==0&&(z===32||z===9)){if(Z===-1&&X!==-1)Z=$}else if(z===44){if(X===-1)throw new SyntaxError(`Unexpected character at index ${$}`);if(Z===-1)Z=$;let j=J.slice(X,Z);if(K.has(j))throw new SyntaxError(`The "${j}" subprotocol is duplicated`);K.add(j),X=Z=-1}else throw new SyntaxError(`Unexpected character at index ${$}`)}if(X===-1||Z!==-1)throw new SyntaxError("Unexpected end of input");let G=J.slice(X,$);if(K.has(G))throw new SyntaxError(`The "${G}" subprotocol is duplicated`);return K.add(G),K}_7.exports={parse:iJ}});var D7=F((vK,F7)=>{var cJ=N("events"),A5=N("http"),{Duplex:SK}=N("stream"),{createHash:nJ}=N("crypto"),N7=f5(),g=e(),rJ=H7(),aJ=R5(),{GUID:oJ,kWebSocket:sJ}=T(),tJ=/^[+/0-9A-Za-z]{22}==$/;class A7 extends cJ{constructor(J,K){super();if(J={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:aJ,...J},J.port==null&&!J.server&&!J.noServer||J.port!=null&&(J.server||J.noServer)||J.server&&J.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(J.port!=null)this._server=A5.createServer((X,Z)=>{let $=A5.STATUS_CODES[426];Z.writeHead(426,{"Content-Length":$.length,"Content-Type":"text/plain"}),Z.end($)}),this._server.listen(J.port,J.host,J.backlog,K);else if(J.server)this._server=J.server;if(this._server){let X=this.emit.bind(this,"connection");this._removeListeners=eJ(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(Z,$,G)=>{this.handleUpgrade(Z,$,G,X)}})}if(J.perMessageDeflate===!0)J.perMessageDeflate={};if(J.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=J,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(J){if(this._state===2){if(J)this.once("close",()=>{J(new Error("The server is not running"))});process.nextTick(Z5,this);return}if(J)this.once("close",J);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(Z5,this);else this._shouldEmitClose=!0;else process.nextTick(Z5,this)}else{let K=this._server;this._removeListeners(),this._removeListeners=this._server=null,K.close(()=>{Z5(this)})}}shouldHandle(J){if(this.options.path){let K=J.url.indexOf("?");if((K!==-1?J.url.slice(0,K):J.url)!==this.options.path)return!1}return!0}handleUpgrade(J,K,X,Z){K.on("error",R7);let $=J.headers["sec-websocket-key"],G=J.headers.upgrade,z=+J.headers["sec-websocket-version"];if(J.method!=="GET"){m(this,J,K,405,"Invalid HTTP method");return}if(G===void 0||G.toLowerCase()!=="websocket"){m(this,J,K,400,"Invalid Upgrade header");return}if($===void 0||!tJ.test($)){m(this,J,K,400,"Missing or invalid Sec-WebSocket-Key header");return}if(z!==8&&z!==13){m(this,J,K,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(J)){$5(K,400);return}let j=J.headers["sec-websocket-protocol"],Q=new Set;if(j!==void 0)try{Q=rJ.parse(j)}catch(Y){m(this,J,K,400,"Invalid Sec-WebSocket-Protocol header");return}let I=J.headers["sec-websocket-extensions"],_={};if(this.options.perMessageDeflate&&I!==void 0){let Y=new g(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let A=N7.parse(I);if(A[g.extensionName])Y.accept(A[g.extensionName]),_[g.extensionName]=Y}catch(A){m(this,J,K,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let Y={origin:J.headers[`${z===8?"sec-websocket-origin":"origin"}`],secure:!!(J.socket.authorized||J.socket.encrypted),req:J};if(this.options.verifyClient.length===2){this.options.verifyClient(Y,(A,M,R,H)=>{if(!A)return $5(K,M||401,R,H);this.completeUpgrade(_,$,Q,J,K,X,Z)});return}if(!this.options.verifyClient(Y))return $5(K,401)}this.completeUpgrade(_,$,Q,J,K,X,Z)}completeUpgrade(J,K,X,Z,$,G,z){if(!$.readable||!$.writable)return $.destroy();if($[sJ])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return $5($,503);let Q=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${nJ("sha1").update(K+oJ).digest("base64")}`],I=new this.options.WebSocket(null,void 0,this.options);if(X.size){let _=this.options.handleProtocols?this.options.handleProtocols(X,Z):X.values().next().value;if(_)Q.push(`Sec-WebSocket-Protocol: ${_}`),I._protocol=_}if(J[g.extensionName]){let _=J[g.extensionName].params,Y=N7.format({[g.extensionName]:[_]});Q.push(`Sec-WebSocket-Extensions: ${Y}`),I._extensions=J}if(this.emit("headers",Q,Z),$.write(Q.concat(`\r
`).join(`\r
`)),$.removeListener("error",R7),I.setSocket($,G,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(I),I.on("close",()=>{if(this.clients.delete(I),this._shouldEmitClose&&!this.clients.size)process.nextTick(Z5,this)});z(I,Z)}}F7.exports=A7;function eJ(J,K){for(let X of Object.keys(K))J.on(X,K[X]);return function X(){for(let Z of Object.keys(K))J.removeListener(Z,K[Z])}}function Z5(J){J._state=2,J.emit("close")}function R7(){this.destroy()}function $5(J,K,X,Z){X=X||A5.STATUS_CODES[K],Z={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(X),...Z},J.once("finish",J.destroy),J.end(`HTTP/1.1 ${K} ${A5.STATUS_CODES[K]}\r
`+Object.keys(Z).map(($)=>`${$}: ${Z[$]}`).join(`\r
`)+`\r
\r
`+X)}function m(J,K,X,Z,$){if(J.listenerCount("wsClientError")){let G=new Error($);Error.captureStackTrace(G,m),J.emit("wsClientError",G,X,K)}else $5(X,Z,$)}});import ZK from"https";var JK=o(I7(),1),KK=o(w5(),1),XK=o(g5(),1),M7=o(R5(),1),b5=o(D7(),1);var d5=M7.default;var P7=ZK.createServer(),$K=new b5.default({server:P7}),f=new Map;$K.on("connection",(J)=>{let K=crypto.randomUUID();f.set(J,K),J.on("message",(X)=>{let Z=JSON.parse(X.toString());if(Z.type==="ready"){if(Z.id!==null)f.set(J,K);J.send(JSON.stringify({type:"init",id:K,peers:GK(K)})),O7(J,{type:"new-user",id:K});return}if(Z.from=K,Z.to!==void 0){let $=[...f.entries()].find(([,G])=>G===Z.to)?.[0];if($&&$.readyState===d5.OPEN)$.send(JSON.stringify(Z))}}),J.on("close",()=>{let X=f.get(J);O7(J,{type:"close",id:X}),f.delete(J)})});function GK(J){return Array.from(f.values()).filter((X)=>X!==J)}function O7(J,K){for(let[X]of f.entries())if(X!==J&&X.readyState===d5.OPEN)X.send(JSON.stringify(K))}P7.listen(443,()=>{console.log("OPEN 443")});
